# QA Flow - Contexto del Proyecto

## üéØ Resumen Ejecutivo

**QA Flow** es una herramienta de automatizaci√≥n de documentaci√≥n QA que parsea User Stories desde Excel, genera test cases BDD/Gherkin usando IA (Google Gemini), y produce documentaci√≥n profesional (PDF, Word, Markdown).

**Estado Actual:** Backend funcional con CLI. **Pr√≥ximo Paso:** Crear interfaz web propia.

---

## üìö Documentos Clave

1. **HANDOFF_DOCUMENT.md** - Gu√≠a t√©cnica de traspaso (LEER PRIMERO)
2. **PROYECTO_REDEFINICION.md** - Nueva visi√≥n y arquitectura
3. **README.md** - Setup e instalaci√≥n
4. **PROJECT_STRUCTURE.txt** - Estructura del c√≥digo

---

## üèóÔ∏è Arquitectura

```
Excel/CSV ‚Üí Parser ‚Üí SQLite ‚Üí Gemini AI ‚Üí Test Cases (.feature) ‚Üí PDF/Word
                                  ‚Üì
                          Interfaz Web (TODO)
```

---

## üíª Stack Tecnol√≥gico

**Backend (Implementado):**
- Python 3.11+
- FastAPI - API REST
- SQLAlchemy + SQLite - Base de datos
- Google Gemini API (gemini-2.5-flash) - IA para generar test cases
- python-docx, reportlab - Generaci√≥n de documentos

**Frontend (Por Implementar):**
- HTML/CSS/JavaScript (vanilla o Vue.js/React)
- Dashboard interactivo
- Gesti√≥n de User Stories, Test Cases, Bug Reports

---

## üìÇ Estructura del C√≥digo

### ‚úÖ Core Funcional (MANTENER)

```
src/
‚îú‚îÄ‚îÄ config.py                      # Configuraci√≥n con Pydantic
‚îú‚îÄ‚îÄ models/                        # Modelos de datos
‚îÇ   ‚îú‚îÄ‚îÄ user_story.py             # UserStory + AcceptanceCriteria
‚îÇ   ‚îú‚îÄ‚îÄ test_case.py              # TestCase + GherkinScenario
‚îÇ   ‚îî‚îÄ‚îÄ bug_report.py             # BugReport
‚îú‚îÄ‚îÄ parsers/
‚îÇ   ‚îî‚îÄ‚îÄ file_parser.py            # Parser Excel/CSV (auto-detecci√≥n)
‚îú‚îÄ‚îÄ generators/
‚îÇ   ‚îú‚îÄ‚îÄ gherkin_generator.py      # Genera archivos .feature
‚îÇ   ‚îú‚îÄ‚îÄ test_plan_generator.py    # Genera PDF + Markdown
‚îÇ   ‚îî‚îÄ‚îÄ bug_template_generator.py # Genera plantillas Word
‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îú‚îÄ‚îÄ gemini_client.py          # Cliente Gemini AI ‚≠ê
‚îÇ   ‚îî‚îÄ‚îÄ azure_devops_client.py    # Cliente Azure DevOps
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ db.py                     # SQLAlchemy setup
‚îÇ   ‚îî‚îÄ‚îÄ models.py                 # UserStoryDB, TestCaseDB, BugReportDB
‚îú‚îÄ‚îÄ cli.py                        # CLI con Typer
‚îî‚îÄ‚îÄ main.py                       # API FastAPI (necesita refactor)
```

### ‚ùå Archivos Obsoletos (ELIMINAR)

```
src/integrations/
‚îú‚îÄ‚îÄ notion_client.py              # ‚ùå Integraci√≥n Notion abandonada
‚îî‚îÄ‚îÄ mcp_notion_client.py          # ‚ùå MCP complejo

src/
‚îú‚îÄ‚îÄ cli_notion_setup.py           # ‚ùå
‚îú‚îÄ‚îÄ notion_ai_orchestrator.py     # ‚ùå
‚îî‚îÄ‚îÄ gemini_mcp_orchestrator.py    # ‚ùå
```

### ‚ú® Por Crear

```
frontend/                         # Interfaz web
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ css/styles.css
‚îî‚îÄ‚îÄ js/app.js

src/api/                          # Endpoints organizados
‚îú‚îÄ‚îÄ user_stories.py
‚îú‚îÄ‚îÄ test_cases.py
‚îî‚îÄ‚îÄ dashboard.py

src/services/                     # L√≥gica de negocio
‚îú‚îÄ‚îÄ user_story_service.py
‚îî‚îÄ‚îÄ metrics_service.py
```

---

## üîë Archivos Cr√≠ticos

### 1. `src/parsers/file_parser.py`
Parser robusto con **auto-detecci√≥n** de columnas Excel.

**Caracter√≠sticas:**
- Detecta variantes de nombres de columnas ("ID" / "User Story ID" / "Historia ID")
- Salta Epics, solo procesa User Stories
- Maneja m√∫ltiples formatos de criterios de aceptaci√≥n

### 2. `src/integrations/gemini_client.py`
Cliente de Google Gemini AI para generaci√≥n autom√°tica.

**Funciones principales:**
```python
generate_gherkin_scenarios(user_story, num_scenarios=5)
# ‚Üí Genera escenarios BDD Given/When/Then

suggest_test_types(user_story)
# ‚Üí Recomienda tipos de test (Functional, UI, API, etc.)

improve_acceptance_criteria(user_story)
# ‚Üí Sugiere mejoras a criterios
```

**Prompt optimizado:** Genera escenarios ESPEC√çFICOS basados en criterios de aceptaci√≥n reales (no gen√©ricos).

### 3. `src/models/user_story.py`
Modelo principal de datos.

```python
class UserStory:
    id: str                                      # "US-001" o "462504"
    title: str                                   # T√≠tulo de la historia
    description: str                             # Descripci√≥n completa
    acceptance_criteria: List[AcceptanceCriteria] # Criterios de aceptaci√≥n
    priority: Priority                           # Critical, High, Medium, Low
    status: Status                               # Backlog, To Do, In Progress, Done

    def get_completion_percentage(self) -> float:
        # Calcula % de criterios completados
```

### 4. `src/generators/gherkin_generator.py`
Genera archivos `.feature` en formato Gherkin/BDD.

**Salida ejemplo:**
```gherkin
Feature: PE | MKT | PILSEN CALLAO | FRESH | FORMULARIO -TRIAL

  @smoke @regression @positive @happy_path
  Scenario: Happy Path - Successful Submission
    Given I am on the 'Formulario' page
    When I enter '12345678' into the 'DNI' field
    And I enter 'user@example.com' into the 'Email' field
    Then I should see a success message
    And I should be redirected to confirmation page
```

---

## üîÑ Flujo de Datos

```
1. Usuario sube ejemplo_user_stories.xlsx
        ‚Üì
2. FileParser.parse_file() extrae User Stories
        ‚Üì
3. Se guardan en SQLite (data/qa_automation.db)
        ‚Üì
4. Usuario ejecuta: generate-tests <ID> --use-ai
        ‚Üì
5. GeminiClient analiza criterios de aceptaci√≥n
        ‚Üì
6. Genera escenarios Gherkin espec√≠ficos
        ‚Üì
7. GherkinGenerator crea archivo .feature
        ‚Üì
8. TestPlanGenerator crea PDF + Markdown
        ‚Üì
9. Archivos guardados en output/
```

---

## üöÄ Comandos √ötiles

### Desarrollo
```bash
# Activar entorno virtual
source venv/bin/activate

# Instalar dependencias
pip install -r requirements.txt

# Iniciar servidor FastAPI
uvicorn src.main:app --reload --port 8000

# Ver API docs
# http://localhost:8000/docs
```

### CLI (Funcional Actual)
```bash
# Parsear Excel
python -m src.cli parse ejemplo_user_stories.xlsx

# Listar User Stories
python -m src.cli list-stories

# Generar test cases con IA para una historia espec√≠fica
python -m src.cli generate-tests 462504 --use-ai --num-scenarios 5

# Flujo completo (parsear + generar + exportar)
python -m src.cli generate-all ejemplo_user_stories.xlsx "Proyecto X" --use-ai
```

---

## üîê Variables de Entorno

**Archivo:** `.env` (NO commitear al repo)

```bash
# Google Gemini AI
GEMINI_API_KEY=AIza...  # ‚ö†Ô∏è SECRETO - Ya configurado

# Azure DevOps (opcional)
AZURE_DEVOPS_ORG_URL=
AZURE_DEVOPS_PAT=
AZURE_DEVOPS_PROJECT=

# App
DEBUG=True
DATABASE_URL=sqlite:///./data/qa_automation.db
OUTPUT_DIR=./output
UPLOAD_DIR=./uploads
```

---

## üìä Base de Datos (SQLite)

**Archivo:** `data/qa_automation.db`

**Tablas:**
- `user_stories` - User Stories parseadas
- `test_cases` - Test cases generados
- `bug_reports` - Bug reports (futuro)

**Acceso:**
```python
from src.database import SessionLocal, UserStoryDB

db = SessionLocal()
stories = db.query(UserStoryDB).all()
```

---

## üéØ Objetivos Principales

### Completado ‚úÖ
- [x] Parser de Excel robusto con auto-detecci√≥n
- [x] Generaci√≥n de test cases con IA (Gemini)
- [x] Exportaci√≥n a PDF, Word, Markdown
- [x] CLI funcional
- [x] Base de datos SQLite
- [x] Modelos de datos completos

### En Progreso üîÑ
- [ ] Limpiar c√≥digo de Notion
- [ ] Refactorizar API FastAPI
- [ ] Crear interfaz web

### Pendiente ‚è≥
- [ ] Dashboard interactivo
- [ ] M√≥dulo de carga de Excel (drag & drop)
- [ ] Vista de User Stories (tabla interactiva)
- [ ] Visualizaci√≥n de test cases (Gherkin viewer)
- [ ] Sistema de m√©tricas y reportes
- [ ] Edici√≥n inline de test cases
- [ ] B√∫squeda y filtros
- [ ] Sistema de versiones

---

## üêõ Problemas Conocidos

1. **Integraci√≥n con Notion abandonada**
   - Era muy compleja (MCP, m√∫ltiples APIs)
   - Generaba p√°ginas duplicadas
   - No ten√≠amos control sobre UI
   - **Soluci√≥n:** Crear interfaz web propia

2. **API FastAPI necesita refactor**
   - Endpoints mezclados en `main.py`
   - Falta organizaci√≥n en m√≥dulos (`src/api/`)
   - **Soluci√≥n:** Reorganizar en Fase 1

3. **CLI no es intuitivo para no t√©cnicos**
   - Funciona bien para desarrollo
   - **Soluci√≥n:** Interfaz web ser√° la UI principal

---

## üìù Pr√≥ximos Pasos (Roadmap)

### Fase 1: Limpieza (Inmediato)
1. Eliminar archivos de Notion (`*notion*.py`)
2. Actualizar `requirements.txt` (quitar `notion-client`)
3. Crear `.gitignore` robusto

### Fase 2: Backend (1-2 d√≠as)
1. Refactorizar `main.py` ‚Üí organizar en `src/api/`
2. Crear endpoints REST:
   - `GET/POST /api/user-stories`
   - `GET/POST /api/test-cases`
   - `POST /api/upload`
   - `GET /api/dashboard/metrics`
   - `POST /api/generate-tests`
3. Agregar CORS para frontend
4. Documentaci√≥n Swagger mejorada

### Fase 3: Frontend (2-3 d√≠as)
1. Crear estructura `frontend/`
2. Dashboard principal con m√©tricas
3. M√≥dulo de carga de Excel (drag & drop)
4. Vista de User Stories (tabla interactiva)
5. Conectar con API usando Fetch/Axios

### Fase 4: Features Avanzadas (3-4 d√≠as)
1. Visualizaci√≥n de test cases (Gherkin viewer con syntax highlighting)
2. Gr√°ficos y m√©tricas (Chart.js)
3. Edici√≥n inline de test cases
4. Sistema de b√∫squeda y filtros
5. Exportaci√≥n multi-formato desde UI

---

## üõ°Ô∏è Seguridad

### ‚ö†Ô∏è Archivos que NO deben subirse a Git:

```
.env                    # API keys y secretos
data/qa_automation.db   # Base de datos (puede tener info sensible)
venv/                   # Entorno virtual
__pycache__/            # Archivos compilados Python
*.pyc                   # Archivos compilados
.DS_Store               # macOS
ejemplo_user_stories.xlsx  # Puede tener datos de proyectos reales
output/                 # Archivos generados (pueden tener info sensible)
```

### ‚úÖ Verificaci√≥n antes de subir:
1. `.env` en `.gitignore` ‚úì
2. API keys no hardcodeadas ‚úì
3. Base de datos SQLite excluida ‚úì
4. Archivos Excel de ejemplo sin datos reales ‚úì

---

## ü§ù Para Otros Desarrolladores/LLMs

### C√≥mo empezar:
1. Lee `HANDOFF_DOCUMENT.md` completo
2. Revisa `PROYECTO_REDEFINICION.md` para contexto
3. Ejecuta el CLI para ver c√≥mo funciona:
   ```bash
   python -m src.cli parse ejemplo_user_stories.xlsx
   python -m src.cli list-stories
   ```
4. Revisa los modelos en `src/models/`
5. Entiende el flujo en `src/parsers/file_parser.py`

### Preguntas frecuentes:
**Q:** ¬øPor qu√© abandonaron Notion?
**A:** Muy complejo, generaba duplicados, no control√°bamos la UI.

**Q:** ¬øQu√© archivos son cr√≠ticos?
**A:** `file_parser.py`, `gemini_client.py`, `gherkin_generator.py`, modelos en `models/`

**Q:** ¬øQu√© tecnolog√≠a usar para el frontend?
**A:** Vanilla JS + Tailwind CSS (simple) o Vue.js (escalable)

**Q:** ¬øEl backend est√° completo?
**A:** S√≠, funciona. Solo necesita refactor de organizaci√≥n.

**Q:** ¬øC√≥mo funciona la IA?
**A:** Gemini lee criterios de aceptaci√≥n y genera escenarios Gherkin espec√≠ficos.

---

## üìö Referencias T√©cnicas

- **FastAPI:** https://fastapi.tiangolo.com/
- **SQLAlchemy:** https://docs.sqlalchemy.org/
- **Gemini API:** https://ai.google.dev/tutorials/python_quickstart
- **Gherkin/BDD:** https://cucumber.io/docs/gherkin/reference/
- **Azure DevOps API:** https://learn.microsoft.com/en-us/rest/api/azure/devops/

---

## ‚ú® Ventajas Competitivas

1. **Generaci√≥n autom√°tica con IA:** Gemini analiza criterios y crea test cases espec√≠ficos
2. **Parser robusto:** Auto-detecta columnas, funciona con m√∫ltiples formatos Excel
3. **Multi-formato:** PDF, Word, Markdown, .feature files
4. **BDD/Gherkin:** Est√°ndar industrial para testing
5. **Local-first:** SQLite + archivos locales = sin dependencias cloud
6. **Extensible:** F√°cil agregar nuevos generadores o integraciones

---

**√öltima Actualizaci√≥n:** 2025-11-14
**Versi√≥n:** 1.0
**Proyecto:** QA Flow - Herramienta de Gesti√≥n QA
**Estado:** Backend funcional, Frontend pendiente
